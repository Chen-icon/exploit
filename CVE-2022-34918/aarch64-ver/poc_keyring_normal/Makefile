SOURCES := $(wildcard src/*.c)
HEADERS := $(wildcard include/*.h)
OBJECTS := $(patsubst src/%.c,obj/%.o,$(SOURCES))
DEPENDS := $(patsubst src/%.c,obj/%.d,$(SOURCES))

# Set the cross-compiler for ARM
CC = aarch64-none-linux-gnu-gcc

CFLAGS = -I./include -I/usr/aarch64-linux-gnu/aarch64-linux-gnu/include -Werror 
LDFLAGS = -static -s -L/usr/aarch64-linux-gnu/lib

TARGET ?= exploit

.PHONY: all clean

all: obj $(TARGET)

$(TARGET): $(OBJECTS)
	$(CC) $(LDFLAGS) $^ -o $@

-include $(DEPENDS)

obj/%.o: src/%.c Makefile
	$(CC) $(CFLAGS) -MMD -MP -c $< -o $@

obj:
	mkdir -p obj

clean:
	rm -rf obj
	rm -f $(TARGET)

